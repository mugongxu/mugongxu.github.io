<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>CentOS7安装gitlab - mugongxu的博客</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/mugongxu"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li><li><a href="http://m.xuguoqian.com/"><span>酷猫</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">CentOS7安装gitlab</h1><ul class="meta"><li><i class="icon icon-author"></i>mugongxu</li><li><i class="icon icon-clock"></i>11 Minutes</li><li><i class="icon icon-calendar"></i>2020年11月17日</li></ul></div></div><div class="article-content" style="max-width:800px"><h1 id="CentOS-7-下-GitLab安装部署教程"><a href="#CentOS-7-下-GitLab安装部署教程" class="headerlink" title="CentOS 7 下 GitLab安装部署教程"></a>CentOS 7 下 GitLab安装部署教程</h1><p><a href="https://about.gitlab.com/install/#centos-7" target="_blank" rel="noopener">可直接到官网查看</a></p>
<h2 id="安装和配置一些必须的依赖"><a href="#安装和配置一些必须的依赖" class="headerlink" title="安装和配置一些必须的依赖"></a>安装和配置一些必须的依赖</h2><h3 id="1、基础依赖"><a href="#1、基础依赖" class="headerlink" title="1、基础依赖"></a>1、基础依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 安装技术依赖</span><br><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 启动ssh服务&amp;设置为开机启动</span><br><span class="line">sudo systemctl enable sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 如果防火墙还没开启，先开启</span><br><span class="line"><span class="meta">#</span> sudo systemctl status firewalld</span><br><span class="line"><span class="meta">#</span> sudo systemctl start firewalld</span><br><span class="line"><span class="meta">#</span> http&amp;https服务（80端口）</span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo firewall-cmd --permanent --add-service=https</span><br><span class="line">sudo systemctl reload firewalld</span><br></pre></td></tr></table></figure>
<h3 id="2、安装Postfix"><a href="#2、安装Postfix" class="headerlink" title="2、安装Postfix"></a>2、安装Postfix</h3><p>Postfix是一个邮件服务器，GitLab发送邮件需要用到<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install postfix</span><br><span class="line"><span class="meta">#</span> 启动postfix并设置为开机启动</span><br><span class="line">sudo systemctl enable postfix</span><br><span class="line">sudo systemctl start postfix</span><br></pre></td></tr></table></figure></p>
<h2 id="下载安装包-amp-amp-安装"><a href="#下载安装包-amp-amp-安装" class="headerlink" title="下载安装包&amp;&amp;安装"></a>下载安装包&amp;&amp;安装</h2><p>gitlab-ee：企业版，部分功能是需要收费的<br>gitlab-ce：社区版，免费的</p>
<p>这里部署的是社区版，如果要部署商业版可以把关键字替换为：gitlab-ee</p>
<h3 id="1、下载安装包"><a href="#1、下载安装包" class="headerlink" title="1、下载安装包"></a>1、下载安装包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure>
<h3 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y gitlab-ce</span><br></pre></td></tr></table></figure>
<p>看到控制台上出现下面内容，就算是安装成功了<br><img src="./success.png" alt="成功"></p>
<h3 id="3、配置Gitlab站点的Url"><a href="#3、配置Gitlab站点的Url" class="headerlink" title="3、配置Gitlab站点的Url"></a>3、配置Gitlab站点的Url</h3><p>例如：<code>https://gitlab.example.com</code> 或 <code>http://gitlab.example.com</code>，配置<code>https</code>需要<a href="https://docs.gitlab.com/omnibus/settings/ssl.html#lets-encrypthttpsletsencryptorg-integration" target="_blank" rel="noopener">配置证书</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> gitlab相应常用命令</span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl start</span><br><span class="line">gitlab-ctl stop</span><br><span class="line">gitlab-ctl reload</span><br></pre></td></tr></table></figure>
<p>如果不配置，那你可以直接启动Gitlab：gitlab-ctl start，直接使用ip访问：<code>http://ip:8080/</code>，默认<code>80</code>端口</p>
<p>GitLab默认的配置文件路径是/etc/gitlab/gitlab.rb</p>
<p>默认的站点Url配置项是：<br><code>external_url &#39;http://gitlab.example.com</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 修改配置文件</span><br><span class="line">sudo vi /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 配置首页地址（大约在第15行）</span><br><span class="line">external_url 'http://gitlab.xuguoqian.com'</span><br></pre></td></tr></table></figure>
<p><img src="./external_url.png" alt="external_url"></p>
<h3 id="启动并访问Gitlab"><a href="#启动并访问Gitlab" class="headerlink" title="启动并访问Gitlab"></a>启动并访问Gitlab</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 重新配置并启动</span><br><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<p>在浏览器上访问：<a href="http://gitlab.xuguoqian.com" target="_blank" rel="noopener">http://gitlab.xuguoqian.com</a></p>
<p><img src="./password_setting.png" alt="初始化设置密码"></p>
<p>密码设置成功后，就可以以默认用户：<code>root + 设置好的密码</code>，进行登录。</p>
<h2 id="异常问题"><a href="#异常问题" class="headerlink" title="异常问题"></a>异常问题</h2><h3 id="1、安装过程的出错"><a href="#1、安装过程的出错" class="headerlink" title="1、安装过程的出错"></a>1、安装过程的出错</h3><p>确保网络正常和服务器内存充足就行，<code>We also strongly recommend at least 4GB of RAM to run GitLab</code>，这是官网对我们友好的提醒，其实<code>2GB</code>的RAM也是勉强能运行的起来的。</p>
<h3 id="2、访问的出错"><a href="#2、访问的出错" class="headerlink" title="2、访问的出错"></a>2、访问的出错</h3><p>新手很容易出现：<br><img src="./502.png" alt="502page"></p>
<p>原因1：<code>内存不足</code>，最小2G，企业级的至少4G以上</p>
<p>2G时，也只是偶发正常，如果是个人学习的，没条件只有2G的，又想运行玩一玩Gitlab，可以考虑一下<a href="https://baike.baidu.com/item/Swap分区/7613378?fr=aladdin" target="_blank" rel="noopener"><code>swap</code></a>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Swap分区在系统的物理内存不够用的时候，把硬盘内存中的一部分空间释放出来，以供当前运行的程序使用。</span><br><span class="line">那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到Swap分区中，</span><br><span class="line">等到那些程序要运行时，再从Swap分区中恢复保存的数据到内存中。</span><br></pre></td></tr></table></figure></p>
<p>swap的值都是安装系统的时候设置好的，一般设置为内存的两倍大小。使用过程中发现swap值过小只能添加。<br>用<code>free -m</code>命令查看当前swap大小<br><img src="./free_01.png" alt="free"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用下面的命令创建2G的空间</span><br><span class="line"><span class="meta">#</span> if 表示infile，of表示outfile，bs=1024代表增加的模块大小，count=2048000代表2048000个模块，也就是2G空间</span><br><span class="line">dd if=/dev/zero of=/var/swap bs=1024 count=2048000</span><br><span class="line"><span class="meta">#</span> 将目的文件设置为swap分区文件</span><br><span class="line">mkswap /var/swap</span><br><span class="line"><span class="meta">#</span> 激活swap，立即启用交换分区文件</span><br><span class="line">mkswap -f /var/swap</span><br></pre></td></tr></table></figure>
<p>free -m查看swap已经增加了，<code>但这只是临时性的，如果机器重启会失效</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 最后一行添加</span><br><span class="line">/var/swap swap swap defaults 0 0</span><br></pre></td></tr></table></figure></p>
<p>重启或free -m测试 swap添加成功</p>
<p>实战命令：<br><img src="./swap_step.png" alt="swap_step"></p>
<p>原因2：<code>端口冲突</code>，默认8080端口，更改默认端口</p>
<p>配置文件在 /opt/gitlab/etc/gitlab.rb 。这个文件用于gitlab如何调用80和8080的服务等。<br><img src="./port_01.png" alt="port_01"><br><img src="./port_02.png" alt="port_02"></p>
<p>下面修改为8082端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## Advanced settings</span><br><span class="line">unicorn[&apos;listen&apos;] = &apos;127.0.0.1&apos;</span><br><span class="line">unicorn[&apos;port&apos;] = 8082</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx[&apos;listen_addresses&apos;] = [&apos;*&apos;]</span><br><span class="line">nginx[&apos;listen_port&apos;] = 8082 # override only if you use a reverse proxy: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#setting-the-nginx-listen-port</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 每次重新配置，都需要执行sudo gitlab-ctl reconfigure </span><br><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<p>一般都能正常访问！</p>
</div><div class="article-meta" style="max-width:800px"></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2020/11/16/CentOS7安装Jenkins/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/BoizZ" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/heqibang" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="https://www.segmentfault.com/u/bon" title="SegmentFault" target="_blank"><i class="icon icon-segmentfault"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2020 mugongxu的博客</p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>