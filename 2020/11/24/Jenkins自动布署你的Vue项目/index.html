<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>Jenkins自动布署你的Vue项目 - mugongxu的博客</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/mugongxu"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li><li><a href="http://m.xuguoqian.com/"><span>酷猫</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">Jenkins自动布署你的Vue项目</h1><ul class="meta"><li><i class="icon icon-author"></i>mugongxu</li><li><i class="icon icon-clock"></i>8 Minutes</li><li><i class="icon icon-calendar"></i>2020年11月24日</li></ul></div></div><div class="article-content" style="max-width:800px"><h2 id="在jenkins中安装nodeJs插件"><a href="#在jenkins中安装nodeJs插件" class="headerlink" title="在jenkins中安装nodeJs插件"></a>在jenkins中安装nodeJs插件</h2><p>因为我们的项目是要用到node打包的，所以先在jenkins的插件管理中安装nodeJs插件，安装后进入全局工具配置，配置一个我们要用到的node版本。<br><img src="./nodejs.png" alt="安装NodeJs拆件"></p>
<p>配置nodejs版本：<br><img src="./set_nodejs.png" alt="配置nodejs版本"></p>
<h2 id="开始创建任务"><a href="#开始创建任务" class="headerlink" title="开始创建任务"></a>开始创建任务</h2><p>新建任务-》构建一个自由风格的软件项目<br><img src="./add_project.png" alt="构建一个自由风格的软件项目"></p>
<h2 id="Jenkins关联Github项目地址"><a href="#Jenkins关联Github项目地址" class="headerlink" title="Jenkins关联Github项目地址"></a>Jenkins关联Github项目地址</h2><p>进入新建的任务，点击<code>配置</code>，进行一下配置操作：</p>
<ol>
<li>github项目路径配置<br><img src="./link_github.png" alt="关联github"></li>
<li>点击添加，添加github账户，这里选择使用账号和密码鉴权来拉取代码，也可以选择SSH<br><img src="./add_cerdifile.png" alt="添加github账户"></li>
<li>选择构建环境并编写shell 命令<br><img src="./create_shell.png" alt="构建环境配置"><br>安装淘宝镜像并安装依赖打包：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line">node -v &amp;&amp;</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org &amp;&amp;</span><br><span class="line">cnpm install &amp;&amp;</span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>配置完成后点击<code>立即构建</code>，等待构建完，点击工作空间，可以发现已经多出一个打包后的目录（<code>Vue</code>项目为<code>dist</code>，这里为<code>React</code>项目的<code>build</code>目录）。点击控制台输出可以查看详细构建log</p>
<p>a.立即构建：<br><img src="./立即构建.png" alt="立即构建"><br>b.工作区：<br><img src="./工作区.png" alt="工作区"><br>c.LOG打印：<br><img src="./log.png" alt="log"></p>
<p>到这里已经实现了本地代码提交到github，然后在jenkins上点击构建，可以<code>拉取代码并且打包</code>，下一步实现打包后的<code>dist(build)</code>目录放到<code>目标服务器</code>上。</p>
<h2 id="部署到目标服务器"><a href="#部署到目标服务器" class="headerlink" title="部署到目标服务器"></a>部署到目标服务器</h2><ol>
<li><p>安装Publish Over SSH 插件<br>安装完插件后，在系统管理-&gt; 系统设置-&gt; Publish over SSH 里设置服务器相关信息</p>
</li>
<li><p>配置Publish Over SSH<br>相关配置项注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SSH登录模式配置：使用密码模式登录可以不填</span><br><span class="line">Passphrase：密码（key的密码，没设置就是空）</span><br><span class="line">Path to key：key文件（私钥）的路径</span><br><span class="line">Key：将私钥复制到这个框中(path to key和key写一个即可)</span><br><span class="line"></span><br><span class="line">SSH Servers的配置：</span><br><span class="line">SSH Server Name：标识的名字（随便你取什么）</span><br><span class="line">Hostname：需要连接ssh的主机名或ip地址（建议ip）</span><br><span class="line">Username：登录服务器用户名</span><br><span class="line">Remote Directory：远程目录（即项目在你的服务器的位置，如：/data/ui/kgmusic）</span><br><span class="line"></span><br><span class="line">高级配置：</span><br><span class="line">Use password authentication, or use a different key：勾选这个可以使用密码登录，不想配ssh的可以用这个先试试</span><br><span class="line">Passphrase / Password：密码登录模式的Username对应的登录密码</span><br><span class="line">Port：端口（默认22）</span><br><span class="line">Timeout (ms)：超时时间（毫秒）默认300000</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="./public_over_ssh.png" alt="public_over_ssh"><br>这里使用账号密码登录，上面的<code>SSH key</code>可以全为空不填：<br><img src="./密码登录模式.png" alt="密码登录模式"><br>填写完后点击test，出现Success说明配置成功:<br><img src="./SSH配置测试.png" alt="SSH配置测试"></p>
<p>实际生产中，项目需要进行<code>负载均衡</code>，那就需要将项目部署到<code>多个服务器</code>上，这时我们可以新增多个<code>SSH Server</code>（其他配置都相同，只是<code>Hostname</code>以及登录服务器的<code>Username</code>和<code>Passphrase</code>，按实际情况填写）<br><img src="./配置多个服务器.png" alt="配置多个服务器"></p>
<ol start="3">
<li><p>修改任务的构建shell<br>我的视图 -&gt; 当前项目任务 -&gt; 配置 -&gt; 构建：<br>构建shell增加将<code>build</code>目录下所有文件打包（Vue项目为<code>dist</code>目录下）<br>构建shell命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line">node -v &amp;&amp;</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org &amp;&amp;</span><br><span class="line">cnpm install &amp;&amp;</span><br><span class="line">npm run build &amp;&amp;</span><br><span class="line">cd build &amp;&amp;</span><br><span class="line">tar -zcvf build.tar.gz *</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置构建后操作<br><img src="./构建后操作.png" alt="构建后操作"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Name: 选择一个你配好的ssh服务器</span><br><span class="line">Source files：写你要传输的文件路径</span><br><span class="line">Remove prefix：要去掉的前缀，不写远程服务器的目录结构将和Source files写的一致</span><br><span class="line">Remote directory：写你要部署在远程服务器的那个目录地址下，不写就是SSH Servers配置里默认远程目录</span><br><span class="line">Exec command：传输完了要执行的命令，我这里执行了进入kgmusic目录,解压缩,解压缩完成后删除压缩包三个命令</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> Exec command：解压文件并删除压缩包</span><br><span class="line">cd /data/ui/kgmusic</span><br><span class="line">tar -xzvf build.tar.gz</span><br><span class="line">rm -rf build.tar.gz</span><br></pre></td></tr></table></figure>
<p>填完后执行构建。成功后登录我们目标服务器发现kgmusic目录下有了要运行的文件：<br><img src="./service.png" alt="server"></p>
<p>接下来实现开发本地push代码到github上后，触发Webhook，jenkins自动执行构建。</p>
<h2 id="触发Webhook，jenkins自动执行构建"><a href="#触发Webhook，jenkins自动执行构建" class="headerlink" title="触发Webhook，jenkins自动执行构建"></a>触发Webhook，jenkins自动执行构建</h2><p>步骤：</p>
<ol>
<li>jenkins安装Generic Webhook Trigger 插件</li>
<li>github添加触发器</li>
</ol>
<p>在之前的kgmusic工程任务 -》 配置 -》 构建触发器，选择Generic Webhook Trigger<br><img src="./webhook_trigger.png" alt="webhook_trigger"><br><img src="./webhook_trigger_config.png" alt="webhook_trigger_config"><br>填写token（随便填写）</p>
<p>选择github项目中的Settings -》 Webhooks&gt;add webhook<br>配置方式按上图红框中的格式，选择在push代码时触发webhook，成功后会在下方出现一个绿色的小勾勾<br><img src="./github_hook.png" alt="github_hook"></p>
<p>简单的jenkins结合github的自动化发版流程就搭建完了。看个人需求了，手动触发构建就不需要Webhook了，如果是监听<code>特有分支(master)</code>的<code>push</code>行为，就可以使用Webhook自动构建。</p>
</div><div class="article-meta" style="max-width:800px"></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2020/11/25/Jenkins在Gitlab中实现/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2020/11/17/CentOS7安装gitlab/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/BoizZ" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/heqibang" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="https://www.segmentfault.com/u/bon" title="SegmentFault" target="_blank"><i class="icon icon-segmentfault"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2020 mugongxu的博客</p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>